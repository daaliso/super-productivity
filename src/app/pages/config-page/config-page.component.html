<div class="page-settings page-wrapper">
  @if (globalCfg) {
    <div>
      <div class="section-wrapper component-wrapper">
        <theme-selector></theme-selector>

        <!-- Global Settings Group -->
        <settings-group [header]="T.PS.GLOBAL_SETTINGS | translate">
          @for (section of globalConfigFormCfg; track section.key) {
            <settings-list-item
              (itemClick)="expandSection(section.key)"
              [icon]="section.icon || 'settings'"
              [iconColor]="section.iconColor || 'primary'"
              [subtitle]="section.subtitle | translate"
              [title]="section.title | translate"
            ></settings-list-item>
          }
          <settings-list-item
            (itemClick)="expandSection('sound')"
            [subtitle]="T.GCF.SOUND.SUBTITLE || 'Audio feedback' | translate"
            [title]="T.GCF.SOUND.TITLE | translate"
            icon="volume_up"
            iconColor="tertiary"
          ></settings-list-item>
        </settings-group>

        <!-- Plugins Group -->
        <settings-group [header]="T.PS.PLUGINS | translate">
          <settings-list-item
            (itemClick)="expandSection('plugins')"
            [subtitle]="'Extend functionality' | translate"
            [title]="T.PS.PLUGINS | translate"
            icon="extension"
            iconColor="secondary"
          ></settings-list-item>
        </settings-group>

        <!-- Productivity Helper Group -->
        <settings-group
          class="tour-productivityHelper"
          [header]="T.PS.PRODUCTIVITY_HELPER | translate"
        >
          @for (section of globalProductivityConfigFormCfg; track section.key) {
            <settings-list-item
              (itemClick)="expandSection(section.key)"
              [icon]="section.icon || 'psychology'"
              [iconColor]="section.iconColor || 'primary'"
              [subtitle]="section.subtitle | translate"
              [title]="section.title | translate"
            ></settings-list-item>
          }
        </settings-group>

        <!-- Sync & Export Group -->
        <settings-group [header]="T.PS.SYNC_EXPORT | translate">
          @let syncSettingsForm = syncSettingsService.syncSettingsForm$ | async;
          <settings-list-item
            (itemClick)="expandSection('sync')"
            [subtitle]="'Cloud backup, sync' | translate"
            [title]="globalSyncConfigFormCfg.title | translate"
            icon="sync"
            iconColor="primary"
          ></settings-list-item>
          @for (section of globalImexFormCfg; track section.key) {
            <settings-list-item
              (itemClick)="expandSection(section.key)"
              [icon]="section.icon || 'import_export'"
              [iconColor]="section.iconColor || 'secondary'"
              [subtitle]="section.subtitle | translate"
              [title]="section.title | translate"
            ></settings-list-item>
          }
        </settings-group>

        <!-- Expanded Section Detail View -->
        @if (expandedSection) {
          <div
            class="expanded-section-overlay"
            (click)="closeSection()"
          >
            <div
              class="expanded-section-container"
              (click)="$event.stopPropagation()"
            >
              <div class="expanded-section-header">
                <button
                  (click)="closeSection()"
                  class="back-button"
                  mat-icon-button
                  type="button"
                >
                  <mat-icon>arrow_back</mat-icon>
                </button>
                <h2 class="section-title">{{ expandedSectionTitle | translate }}</h2>
              </div>

              <div class="expanded-section-content">
                @switch (expandedSection) {
                  @case ('sound') {
                    <config-sound-form
                      (save)="saveGlobalCfg($event)"
                      [cfg]="getGlobalCfgSection('sound')"
                    ></config-sound-form>
                  }
                  @case ('plugins') {
                    <plugin-management></plugin-management>
                  }
                  @case ('sync') {
                    @if (syncSettingsForm) {
                      <config-form
                        (save)="syncSettingsService.updateSettingsFromForm($event.config)"
                        [cfg]="syncSettingsForm"
                        [formCfg]="globalSyncConfigFormCfg.items"
                        [sectionKey]="globalSyncConfigFormCfg.key"
                      ></config-form>
                    }
                  }
                  @default {
                    @if (getConfigSectionByKey(expandedSection); as section) {
                      <config-form
                        (save)="saveGlobalCfg($event)"
                        [cfg]="getGlobalCfgSection(expandedSection)"
                        [formCfg]="section.items"
                        [sectionKey]="section.key"
                      ></config-form>
                    }
                  }
                }
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>

<footer
  class="version-footer"
  title="Rev {{ versions?.revision }} {{ versions?.branch }} {{ versions?.version }}"
>
  Super Productivity
  <a
    href="https://github.com/johannesjo/super-productivity/blob/master/CHANGELOG.md"
    target="_blank"
    >{{ appVersion }}</a
  >
  –
  <a
    (click)="downloadLogs(); $event?.preventDefault()"
    href="#"
    >Logs</a
  >
  –
  <a
    href="https://super-productivity.com/privacy/"
    target="_blank"
    >{{ T.PS.PRIVACY_POLICY | translate }}</a
  >
  –
  <a
    href="https://github.com/johannesjo/super-productivity/discussions/new"
    target="_blank"
    >{{ T.PS.PROVIDE_FEEDBACK | translate }}</a
  >
</footer>
