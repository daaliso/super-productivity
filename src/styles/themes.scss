@use '@angular/material' as mat;
@use 'sass:map';

// -------------------------------------------------------------------------
// M3 BASE SETUP
// -------------------------------------------------------------------------

$base-theme: mat.define-theme(
  (
    color: (
      theme-type: light,
      use-system-variables: true,
      system-variables-prefix: sys,
    ),
    typography: (
      use-system-variables: true,
      system-variables-prefix: sys,
    ),
    density: (
      scale: 0,
    ),
  )
);

:root {
  @include mat.all-component-themes($base-theme);
  @include mat.system-level-colors($base-theme);
  @include mat.system-level-typography($base-theme);
}

// -------------------------------------------------------------------------
// MIXINS
// -------------------------------------------------------------------------

@mixin apply-json-theme($theme-map, $is-dark: false) {
  $schemes: map.get($theme-map, 'schemes');
  $palette: if($is-dark, map.get($schemes, 'dark'), map.get($schemes, 'light'));

  --sys-primary: #{map.get($palette, 'primary')};
  --sys-on-primary: #{map.get($palette, 'onPrimary')};
  --sys-primary-container: #{map.get($palette, 'primaryContainer')};
  --sys-on-primary-container: #{map.get($palette, 'onPrimaryContainer')};

  --sys-secondary: #{map.get($palette, 'secondary')};
  --sys-on-secondary: #{map.get($palette, 'onSecondary')};
  --sys-secondary-container: #{map.get($palette, 'secondaryContainer')};
  --sys-on-secondary-container: #{map.get($palette, 'onSecondaryContainer')};

  --sys-tertiary: #{map.get($palette, 'tertiary')};
  --sys-on-tertiary: #{map.get($palette, 'onTertiary')};
  --sys-tertiary-container: #{map.get($palette, 'tertiaryContainer')};
  --sys-on-tertiary-container: #{map.get($palette, 'onTertiaryContainer')};

  --sys-error: #{map.get($palette, 'error')};
  --sys-on-error: #{map.get($palette, 'onError')};
  --sys-error-container: #{map.get($palette, 'errorContainer')};
  --sys-on-error-container: #{map.get($palette, 'onErrorContainer')};

  --sys-background: #{map.get($palette, 'background')};
  --sys-on-background: #{map.get($palette, 'onBackground')};

  --sys-surface: #{map.get($palette, 'surface')};
  --sys-on-surface: #{map.get($palette, 'onSurface')};
  --sys-surface-variant: #{map.get($palette, 'surfaceVariant')};
  --sys-on-surface-variant: #{map.get($palette, 'onSurfaceVariant')};

  --sys-outline: #{map.get($palette, 'outline')};
  --sys-outline-variant: #{map.get($palette, 'outlineVariant')};

  --sys-inverse-surface: #{map.get($palette, 'inverseSurface')};
  --sys-inverse-on-surface: #{map.get($palette, 'inverseOnSurface')};
  --sys-inverse-primary: #{map.get($palette, 'inversePrimary')};

  --sys-surface-dim: #{map.get($palette, 'surfaceDim')};
  --sys-surface-bright: #{map.get($palette, 'surfaceBright')};
  --sys-surface-container-lowest: #{map.get($palette, 'surfaceContainerLowest')};
  --sys-surface-container-low: #{map.get($palette, 'surfaceContainerLow')};
  --sys-surface-container: #{map.get($palette, 'surfaceContainer')};
  --sys-surface-container-high: #{map.get($palette, 'surfaceContainerHigh')};
  --sys-surface-container-highest: #{map.get($palette, 'surfaceContainerHighest')};

  // Expressive Material 3 tokens
  --sys-corner-radius-none: 0px;
  --sys-corner-radius-extra-small: 4px;
  --sys-corner-radius-small: 8px;
  --sys-corner-radius-medium: 12px;
  --sys-corner-radius-large: 16px;
  --sys-corner-radius-extra-large: 28px;
  --sys-corner-radius-full: 9999px;

  // M3 Expressive Shape Morphing Support
  --sys-shape-morph-duration: var(--motion-duration-medium);
  --sys-shape-morph-easing: var(--motion-spring-spatial-default);

  // Squircle approximations (superellipse)
  // Use with clip-path for true squircles, or border-radius for approximation
  --sys-shape-squircle-small: 25%;
  --sys-shape-squircle-medium: 35%;
  --sys-shape-squircle-large: 45%;

  // Typography - Google Sans Flex with fallbacks
  --sys-font-family-brand:
    'Google Sans Flex', 'Open Sans', 'Roboto', system-ui, sans-serif;
  --sys-font-family-plain: 'Open Sans', 'Roboto', system-ui, sans-serif;
}

// -------------------------------------------------------------------------
// THEME REGISTRY
// -------------------------------------------------------------------------

$theme-blue: (
  schemes: (
    light: (
      primary: #415f91,
      onPrimary: #ffffff,
      primaryContainer: #d6e3ff,
      onPrimaryContainer: #284777,
      secondary: #565f71,
      onSecondary: #ffffff,
      secondaryContainer: #dae2f9,
      onSecondaryContainer: #3e4759,
      tertiary: #705575,
      onTertiary: #ffffff,
      tertiaryContainer: #fad8fd,
      onTertiaryContainer: #573e5c,
      error: #ba1a1a,
      onError: #ffffff,
      errorContainer: #ffdad6,
      onErrorContainer: #93000a,
      background: #f9f9ff,
      onBackground: #191c20,
      surface: #f9f9ff,
      onSurface: #191c20,
      surfaceVariant: #e0e2ec,
      onSurfaceVariant: #44474e,
      outline: #74777f,
      outlineVariant: #c4c6d0,
      inverseSurface: #2e3036,
      inverseOnSurface: #f0f0f7,
      inversePrimary: #aac7ff,
      surfaceDim: #d9d9e0,
      surfaceBright: #f9f9ff,
      surfaceContainerLowest: #ffffff,
      surfaceContainerLow: #f3f3fa,
      surfaceContainer: #ededf4,
      surfaceContainerHigh: #e7e8ee,
      surfaceContainerHighest: #e2e2e9,
    ),
    dark: (
      primary: #aac7ff,
      onPrimary: #0a305f,
      primaryContainer: #284777,
      onPrimaryContainer: #d6e3ff,
      secondary: #bec6dc,
      onSecondary: #283141,
      secondaryContainer: #3e4759,
      onSecondaryContainer: #dae2f9,
      tertiary: #ddbce0,
      onTertiary: #3f2844,
      tertiaryContainer: #573e5c,
      onTertiaryContainer: #fad8fd,
      error: #ffb4ab,
      onError: #690005,
      errorContainer: #93000a,
      onErrorContainer: #ffdad6,
      background: #111318,
      onBackground: #e2e2e9,
      surface: #111318,
      onSurface: #e2e2e9,
      surfaceVariant: #44474e,
      onSurfaceVariant: #c4c6d0,
      outline: #8e9099,
      outlineVariant: #44474e,
      inverseSurface: #e2e2e9,
      inverseOnSurface: #2e3036,
      inversePrimary: #415f91,
      surfaceDim: #111318,
      surfaceBright: #37393e,
      surfaceContainerLowest: #0c0e13,
      surfaceContainerLow: #191c20,
      surfaceContainer: #1d2024,
      surfaceContainerHigh: #282a2f,
      surfaceContainerHighest: #33353a,
    ),
  ),
);

$theme-green: (
  schemes: (
    light: (
      primary: #4c662b,
      onPrimary: #ffffff,
      primaryContainer: #cdeda3,
      onPrimaryContainer: #354e15,
      secondary: #586249,
      onSecondary: #ffffff,
      secondaryContainer: #dce7c7,
      onSecondaryContainer: #404a33,
      tertiary: #386663,
      onTertiary: #ffffff,
      tertiaryContainer: #bcece7,
      onTertiaryContainer: #1f4e4b,
      error: #ba1a1a,
      onError: #ffffff,
      errorContainer: #ffdad6,
      onErrorContainer: #93000a,
      background: #f9faef,
      onBackground: #1a1c16,
      surface: #f9faef,
      onSurface: #1a1c16,
      surfaceVariant: #e1e4d5,
      onSurfaceVariant: #44483d,
      outline: #75796c,
      outlineVariant: #c5c8ba,
      inverseSurface: #2f312a,
      inverseOnSurface: #f1f2e6,
      inversePrimary: #b2d189,
      surfaceDim: #dadbd0,
      surfaceBright: #f9faef,
      surfaceContainerLowest: #ffffff,
      surfaceContainerLow: #f3f4e9,
      surfaceContainer: #eeefe3,
      surfaceContainerHigh: #e8e9de,
      surfaceContainerHighest: #e2e3d8,
    ),
    dark: (
      primary: #b2d189,
      onPrimary: #203701,
      primaryContainer: #354e15,
      onPrimaryContainer: #cdeda3,
      secondary: #c0cbac,
      onSecondary: #2a331e,
      secondaryContainer: #404a33,
      onSecondaryContainer: #dce7c7,
      tertiary: #a0d0cb,
      onTertiary: #003734,
      tertiaryContainer: #1f4e4b,
      onTertiaryContainer: #bcece7,
      error: #ffb4ab,
      onError: #690005,
      errorContainer: #93000a,
      onErrorContainer: #ffdad6,
      background: #12140e,
      onBackground: #e2e3d8,
      surface: #12140e,
      onSurface: #e2e3d8,
      surfaceVariant: #44483d,
      onSurfaceVariant: #c5c8ba,
      outline: #8f9285,
      outlineVariant: #44483d,
      inverseSurface: #e2e3d8,
      inverseOnSurface: #2f312a,
      inversePrimary: #4c662b,
      surfaceDim: #12140e,
      surfaceBright: #383a32,
      surfaceContainerLowest: #0d0f09,
      surfaceContainerLow: #1a1c16,
      surfaceContainer: #1e201a,
      surfaceContainerHigh: #282b24,
      surfaceContainerHighest: #33362e,
    ),
  ),
);

$theme-yellow: (
  schemes: (
    light: (
      primary: #6b5f10,
      onPrimary: #ffffff,
      primaryContainer: #f5e389,
      onPrimaryContainer: #514700,
      secondary: #655f41,
      onSecondary: #ffffff,
      secondaryContainer: #ece3bc,
      onSecondaryContainer: #4d472b,
      tertiary: #426650,
      onTertiary: #ffffff,
      tertiaryContainer: #c3ecd0,
      onTertiaryContainer: #2a4e3a,
      error: #ba1a1a,
      onError: #ffffff,
      errorContainer: #ffdad6,
      onErrorContainer: #93000a,
      background: #fff9eb,
      onBackground: #1d1c13,
      surface: #fff9eb,
      onSurface: #1d1c13,
      surfaceVariant: #e9e2d0,
      onSurfaceVariant: #4a4739,
      outline: #7b7768,
      outlineVariant: #ccc6b5,
      inverseSurface: #333027,
      inverseOnSurface: #f6f0e2,
      inversePrimary: #d8c770,
      surfaceDim: #dfdacc,
      surfaceBright: #fff9eb,
      surfaceContainerLowest: #ffffff,
      surfaceContainerLow: #f9f3e5,
      surfaceContainer: #f3ede0,
      surfaceContainerHigh: #eee8da,
      surfaceContainerHighest: #e8e2d4,
    ),
    dark: (
      primary: #d8c770,
      onPrimary: #383000,
      primaryContainer: #514700,
      onPrimaryContainer: #f5e389,
      secondary: #d0c7a2,
      onSecondary: #353116,
      secondaryContainer: #4d472b,
      onSecondaryContainer: #ece3bc,
      tertiary: #a8d0b5,
      onTertiary: #123724,
      tertiaryContainer: #2a4e3a,
      onTertiaryContainer: #c3ecd0,
      error: #ffb4ab,
      onError: #690005,
      errorContainer: #93000a,
      onErrorContainer: #ffdad6,
      background: #15130c,
      onBackground: #e8e2d4,
      surface: #15130c,
      onSurface: #e8e2d4,
      surfaceVariant: #4a4739,
      onSurfaceVariant: #ccc6b5,
      outline: #959180,
      outlineVariant: #4a4739,
      inverseSurface: #e8e2d4,
      inverseOnSurface: #333027,
      inversePrimary: #6b5f10,
      surfaceDim: #15130c,
      surfaceBright: #3c3930,
      surfaceContainerLowest: #100e07,
      surfaceContainerLow: #1d1c13,
      surfaceContainer: #222017,
      surfaceContainerHigh: #2c2a21,
      surfaceContainerHighest: #37352b,
    ),
  ),
);

$theme-brown: (
  schemes: (
    light: (
      primary: #8f4c35,
      onPrimary: #ffffff,
      primaryContainer: #ffdbd0,
      onPrimaryContainer: #723520,
      secondary: #77574d,
      onSecondary: #ffffff,
      secondaryContainer: #ffdbd0,
      onSecondaryContainer: #5d4036,
      tertiary: #6a5e2f,
      onTertiary: #ffffff,
      tertiaryContainer: #f3e2a7,
      onTertiaryContainer: #51461a,
      error: #ba1a1a,
      onError: #ffffff,
      errorContainer: #ffdad6,
      onErrorContainer: #93000a,
      background: #fff8f6,
      onBackground: #231917,
      surface: #fff8f6,
      onSurface: #231917,
      surfaceVariant: #f5ded7,
      onSurfaceVariant: #53433f,
      outline: #85736e,
      outlineVariant: #d8c2bb,
      inverseSurface: #392e2b,
      inverseOnSurface: #ffede8,
      inversePrimary: #ffb59d,
      surfaceDim: #e8d6d1,
      surfaceBright: #fff8f6,
      surfaceContainerLowest: #ffffff,
      surfaceContainerLow: #fff1ed,
      surfaceContainer: #fceae5,
      surfaceContainerHigh: #f7e4df,
      surfaceContainerHighest: #f1dfda,
    ),
    dark: (
      primary: #ffb59d,
      onPrimary: #55200c,
      primaryContainer: #723520,
      onPrimaryContainer: #ffdbd0,
      secondary: #e7bdb0,
      onSecondary: #442a21,
      secondaryContainer: #5d4036,
      onSecondaryContainer: #ffdbd0,
      tertiary: #d6c68d,
      onTertiary: #393005,
      tertiaryContainer: #51461a,
      onTertiaryContainer: #f3e2a7,
      error: #ffb4ab,
      onError: #690005,
      errorContainer: #93000a,
      onErrorContainer: #ffdad6,
      background: #1a110f,
      onBackground: #f1dfda,
      surface: #1a110f,
      onSurface: #f1dfda,
      surfaceVariant: #53433f,
      onSurfaceVariant: #d8c2bb,
      outline: #a08d87,
      outlineVariant: #53433f,
      inverseSurface: #f1dfda,
      inverseOnSurface: #392e2b,
      inversePrimary: #8f4c35,
      surfaceDim: #1a110f,
      surfaceBright: #423733,
      surfaceContainerLowest: #140c0a,
      surfaceContainerLow: #231917,
      surfaceContainer: #271d1a,
      surfaceContainerHigh: #322825,
      surfaceContainerHighest: #3d322f,
    ),
  ),
);

// -------------------------------------------------------------------------
// APPLY THEMES
// -------------------------------------------------------------------------

// Blue theme
body.theme-blue,
:root:has(body.theme-blue) {
  @include apply-json-theme($theme-blue, false);
}

body.theme-blue.isDarkTheme,
body.isDarkTheme.theme-blue,
:root:has(body.theme-blue.isDarkTheme),
:root:has(body.isDarkTheme.theme-blue) {
  @include apply-json-theme($theme-blue, true);
}

// Green theme
body.theme-green,
:root:has(body.theme-green) {
  @include apply-json-theme($theme-green, false);
}

body.theme-green.isDarkTheme,
body.isDarkTheme.theme-green,
:root:has(body.theme-green.isDarkTheme),
:root:has(body.isDarkTheme.theme-green) {
  @include apply-json-theme($theme-green, true);
}

// Yellow theme
body.theme-yellow,
:root:has(body.theme-yellow) {
  @include apply-json-theme($theme-yellow, false);
}

body.theme-yellow.isDarkTheme,
body.isDarkTheme.theme-yellow,
:root:has(body.theme-yellow.isDarkTheme),
:root:has(body.isDarkTheme.theme-yellow) {
  @include apply-json-theme($theme-yellow, true);
}

// Brown theme
body.theme-brown,
:root:has(body.theme-brown) {
  @include apply-json-theme($theme-brown, false);
}

body.theme-brown.isDarkTheme,
body.isDarkTheme.theme-brown,
:root:has(body.theme-brown.isDarkTheme),
:root:has(body.isDarkTheme.theme-brown) {
  @include apply-json-theme($theme-brown, true);
}

// -------------------------------------------------------------------------
// COMPATIBILITY / UTILITIES
// -------------------------------------------------------------------------

.bg-card {
  background-color: var(--sys-surface-container-low);
  // Optional: add card border radius or shadow here if needed
  border-radius: var(--sys-corner-radius-medium);
}

.bg-primary {
  background-color: var(--sys-primary);
  color: var(--sys-on-primary);
}

.bg-accent {
  background-color: var(--sys-secondary);
  color: var(--sys-on-secondary);
}

.bg-warn {
  background-color: var(--sys-error);
  color: var(--sys-on-error);
}

// Global dark mode background fix if not covered by mat-app-background
.isDarkTheme body {
  background-color: var(--sys-background);
  color: var(--sys-on-background);
}
